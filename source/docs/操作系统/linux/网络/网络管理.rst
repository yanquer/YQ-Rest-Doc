==========================
网络管理
==========================

几个相关的配置文件

- /etc/resolv.conf DNS配置相关的文件, 内容就是当前正在使用的DNS,
  如::

    #
    # macOS Notice
    #
    # This file is not consulted for DNS hostname resolution, address
    # resolution, or the DNS query routing mechanism used by most
    # processes on this system.
    #
    # To view the DNS configuration used by this system, use:
    #   scutil --dns
    #
    # SEE ALSO
    #   dns-sd(1), scutil(8)
    #
    # This file is automatically generated.
    #
    nameserver 192.168.1.1
    nameserver 192.168.1.1

  ``#`` 表示注释, nameserver表示使用的DNS服务器. 我这里是连的WIFI, 所以使用路由器那边网关提供的路由

- /etc/network/interfaces Unix/Linux 系统网络配置的传统文件，该文件通常用于手动配置网络接口以及 IP 地址等相关参数
  高版本如Ubuntu 20.04 中，所有的网络设置都已经转移到了 NetworkManager 当中，此文件不再被默认使用.
  配置比NetworkManager 更复杂

NetworkManager

- /usr/lib/NetworkManager/conf.d/ 默认的系统级配置文件路径, 包含了一些系统级别的配置文件，
  它们是由软件包提供方安装的，这些文件通常不应该被用户轻易修改。
  如果您确实需要修改其中的某些配置选项，可以使用 /etc/NetworkManager/conf.d/ 目录下的本地配置文件进行覆盖。
- ~/.config/NetworkManager/ 默认的用户级配置文件路径, 包含当前用户特定的NetworkManager配置文件.
- /etc/NetworkManager/NetworkManager.conf NetworkManager 的主要配置文件，它包含了系统级别的默认配置选项。
  在该文件中可以配置很多选项，例如要使用哪种插件来管理网络接口、是否启用 DNS 重写等等。
  如其中的 `[ifupdown]` 下配置 `managed=true` 表示自启动
- /etc/NetworkManager/conf.d/ 目录, 此文件夹下可能有一些配置文件. 包含了一些本地的配置文件，
  它们会覆盖掉 /usr/lib/NetworkManager/conf.d/ 中一些系统级别的配置文件。
  如果您需要修改 NetworkManager 的某些配置选项，最好在该目录下创建一个新的配置文件，并将修改后的内容写入到该文件中。
- /etc/NetworkManager/system-connections/ 包含了所有存储在系统中的网络连接的详细信息。
  每个网络连接都有一个对应的 .nmconnection 文件，其中包含了该连接的所有参数。
  如果需要手动修改某个网络连接的参数（例如 IP 地址或者 DNS 服务器），可以编辑该文件并修改对应的值。

.. sidebar::

    在公司Ubuntu20的云桌面上找了很久的 ``Wired connection`` 在哪配置自动链接ipv4, 最终发现除了图形界面的设置,
    还写到了 `/etc/NetworkManager/system-connections/Wired connection 1.nmconnection`

    而此网卡 `ens18` 的ip, dns在 `/etc/NetworkManager/system-connections/ens18.nmconnection`

.. note::

    有一个 :doc:`/docs/操作系统/linux/linux指令/nmcli` 指令支持

图形界面的网络配置工具
==========================

Debian 系统 NM 的官方文档位于 “`/usr/share/doc/network-manager/README.Debian`” 。

本质上，如下操作即可完成桌面的网络配置。

1. 通过下列命令使桌面用户 `foo` 归属 “`netdev`” 组,
   另外，例如 GNOME 和 KDE 这样的现代桌面环境会通过 `D-bus <https://zh.wikipedia.org/wiki/D-Bus>` 自动完成该操作::

    $ sudo adduser foo netdev

2. 使 “`/etc/network/interfaces`” 的配置保持
   下面那样简洁::

    auto lo
    iface lo inet loopback

3. 通过下列命令重新
   启动 NM::

    $ sudo systemctl restart network-manager

4. 通过图形界面配置网络。

.. note::

  只有 **不** 列在 “`/etc/network/interfaces`” 中的接口会被 NM 管理，以避免与 `ifupdown` 的冲突。

  如果你想扩展 NM 的网络配置功能，请寻找适当的插件模块和补充软件包，
  例如 `network-manager-openconnect`、 `network-manager-openvpn-gnome`、s s
  `network-manager-pptp-gnome`、 `mobile-broadband-provider-info`、 `gnome-bluetooth` 等等。








