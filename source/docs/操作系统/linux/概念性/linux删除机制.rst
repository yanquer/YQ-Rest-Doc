============================
linux删除机制
============================


.. post:: 2024-02-21 21:55:17
  :tags: linux, 概念性
  :category: 操作系统
  :author: YanQue
  :location: CD
  :language: zh-cn


linux下文件是否真实存在可以通过硬连接判断

只要该文件硬连接数量大于等于1, 那么它就真实存在(数量就是有多少份而已)

而删除的时候, 需要保证两种链接的数量都为0, 才能真正删除:

- i_count, 被调用计数(可以理解为内存的引用计数器)
- i_nlink, 硬链接计数

使用rm删除一个文件时, 只是将i_nlink的数目减1,
但是若在此之前存在调用且未结束时, rm可以成功执行, 但是并不会真正从磁盘删除(因为i_count不为0)

如果要在这个时候找回被删除的文件, 停下其他的磁盘写入进程(防止对应的数据区块被覆盖), 然后找到当前这个被删除的文件就行
可以使用 lsof 或者直接去 /proc下找即可.
如::

  lsof | grep deleted

.. note::

  检查link的办法::

    ls -ihl

  检查i_count的办法(-u指在每个进程后显现所属的用户名，-v指详细形式)::

    fuser -uv [绝对路径文件名]



