=====================
grep
=====================

用于查找文件里符合条件的字符串。

grep 指令用于查找内容包含指定的范本样式的文件，如果发现某文件的内容符合所指定的范本样式，预设 grep 指令会把含有范本样式的那一列显示出来。

**若不指定任何文件名称，或是所给予的文件名为 -，则 grep 指令会从标准输入设备读取数据。**

语法::

    grep [-abcEFGhHilLnqrsvVwxy][-A<显示行数>][-B<显示列数>][-C<显示列数>][-d<进行动作>][-e<范本样式>][-f<范本文件>][--help][范本样式][文件或目录...]


选项参数(常用)
=====================

-E          在扩展正则模式下
-P          在Perl正则模式下
-V          将不匹配的过滤出来
-r          递归查找
-r, -R      递归查找
-q          安静模式，不在屏幕上输出
-i          忽略大小写
-n          增加行号
-o          只输出文件中匹配到的部分
-m<num>, --max-count=<num>   找到num行结果后停止查找，用来限制匹配行数
--color     红色输出

全部可参考: `Linux grep 命令 <https://www.runoob.com/linux/linux-comm-grep.html#:~:text=Linux%20grep%20命令%201%20-a%20或%20--text%20%3A,计算符合样式的列数%E3%80%82%206%20-C%3C显示行数%3E%20或%20--context%3D%3C显示行数%3E或-%3C显示行数%3E%20%3A%20除了显示符合样式的那一行之外，并显示该行之前后的内容%E3%80%82%20更多项目>`_

获取文件内容所在行::

    cat file | grep -n 'xxx' | cut -d ':' -f 1

    # 或者
    grep -n 'xxx' file | cut -d ':' -f 1

搜索data文件夹下的所有文件, 是否包含pack::

    grep -r "pack" data

全部选项

-a, --text                                          不要忽略二进制的数据。
-A<显示行数>, --after-context=<显示行数>            除了显示符合范本样式的那一列之外，并显示该行之后的内容。
-b, --byte-offset                                   在显示符合样式的那一行之前，标示出该行第一个字符的编号。
-B<显示行数>, --before-context=<显示行数>           除了显示符合样式的那一行之外，并显示该行之前的内容。
-c, --count                                         计算符合样式的列数。
-C<显示行数>, --context=<显示行数>                  或者直接 `-<显示行数>` . 除了显示符合样式的那一行之外，并显示该行之前后的内容。
-d <动作>, --directories=<动作>                     当指定要查找的是目录而非文件时，必须使用这项参数，否则grep指令将回报信息并停止动作。
-e<范本样式>, --regexp=<范本样式>                   指定字符串做为查找文件内容的样式。
-E, --extended-regexp                   将样式为延伸的正则表达式来使用。
-f<规则文件>, --file=<规则文件>         指定规则文件，其内容含有一个或多个规则样式，让grep查找符合规则条件的文件内容，格式为每行一个规则样式。
-F, --fixed-regexp           将样式视为固定字符串的列表。
-G, --basic-regexp           将样式视为普通的表示法来使用。
-h, --no-filename            在显示符合样式的那一行之前，不标示该行所属的文件名称。
-H, --with-filename          在显示符合样式的那一行之前，表示该行所属的文件名称。
-i, --ignore-case            忽略字符大小写的差别。
-l, --file-with-matches      列出文件内容符合指定的样式的文件名称。
-L, --files-without-match    列出文件内容不符合指定的样式的文件名称。
-n, --line-number            在显示符合样式的那一行之前，标示出该行的列数编号。
-o, --only-matching          只显示匹配PATTERN 部分。
-q, --quiet, --silent        不显示任何信息。
-r, --recursive              此参数的效果和指定"-d recurse"参数相同。
-s, --no-messages            不显示错误信息。
-v, --invert-match           显示不包含匹配文本的所有行。
-V, --version                显示版本信息。
-w, --word-regexp            只显示全字符合的列。
-x, --line-regexp            只显示全列符合的列。
-y                           此参数的效果和指定"-i"参数相同。

.. _GrepExclude:

grep去除本身
=====================

有个小技巧, 与ps结合的时候, grep的结果往往会包含grep当前查询本身,
那么如何去掉?
死办法::

    ps | grep test | grep -v grep

优雅点::

    ps | grep "tes[t]"

稍微解释一下, ``[t]`` 表示一个正则, 只能选择字符 z,
与直接查询效果是一致的, 能排出掉grep本身, 是因为这时候grep进程大致长这::

    ps | grep "tes[t]"

不会解析正则, 所以可以直接排除掉





